<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  <meta name="viewport" content="width=device-width" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/
font-awesome/5.15.2/css/all.min.css" />

  <link href="https://cdn.jsdelivr.net/npm/halfmoon@1.1.1/css/halfmoon.min.css" rel="stylesheet" />

  <style>
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
      grid-template-rows: auto;
      column-gap: 10px;
      row-gap: 15px;
    }

    a:link {
      text-decoration: none;
      color: orange;
    }

    .searchbox {
      margin-left: 15%;
      padding: 15px;
      border-radius: 10px;
    }

    #phonebook {}

    #dir {}

    input[type=text] {
      width: 30%;
      -webkit-transition: width 0.15s ease-in-out;
      transition: width 0.15s ease-in-out;
    }

    /* When the input field gets focus,
        change its width to 100% */
    input[type=text]:focus {
      width: 70%;
    }
  </style>
</head>

<body class="with-custom-webkit-scrollbars with-custom-css-scrollbars" data-dm-shortcut-enabled="true"
  data-set-preferred-mode-onload="true">

  <div class="page-wrapper with-navbar-fixed-bottom">


    <div class="content-wrapper">
      <h1>Phone book</h1>

      <div class="searchbox">
        <h2> Search </h2>
        <input id="searchbar" onkeyup="search_dir()" type="text" name="search" placeholder="Search dir..">
      </div>

      <div class="container-fluid">
        <details class="collapse-panel mw-full mt-20" open>
          <!-- w-400 = width: 40rem (400px), mw-full = max-width: 100%, mt-20 = margin-top: 2rem (20px) -->
          <summary class="collapse-header">
            What is the most efficient animal?
          </summary>
          <div class="collapse-content">

            <div class="card h-lg-300 overflow-y-lg-auto">
              <div id="phonebook" class="row row-eq-spacing"></div>
            </div>

          </div>
        </details>
      </div>
    </div>

    <nav class="navbar navbar-fixed-bottom">
      <!-- Reference: https://www.gethalfmoon.com/docs/navbar#navbar-fixed-bottom -->
      <button class="btn btn-action mr-5" type="button" onclick="halfmoon.toggleDarkMode()"
        aria-label="Toggle dark mode">
        <i class="fas fa-moon" aria-hidden="true"></i>
      </button>
    </nav>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/halfmoon@1.1.1/js/halfmoon.min.js"></script>

  <script>

    fetch('directory.json').then(response => {
      return response.json();
    }).then(jsondata => {
      loadDirectory(jsondata)
    })
      .catch(err => { console.log('Error: ' + err) });


    function loadDirectory(data) {
      var i = 0;

      data.sort(getorderAZ("Location"))

      function getorderAZ(prop) {
        return function (a, b) {
          if (a[prop] > b[prop]) {
            return 1
          } else if (a[prop] < b[prop]) {
            return -1
          }
          return 0
        }
      }

      console.log(data)
      var div = document.getElementById('phonebook')


      for (i = 0; i < data.length; i++) {

        dir = document.createElement('div')
        dir.id = "dir"

        var dial = 'telprompt://' + data[i].Number

        dir.className = "directory col-12 col-md-4 col-xl-3"
        dir.innerHTML = '<div class="card">' +
          '<h3 class="card-title text-wrap searchme">' + data[i].Location + '</h3>' +
          '<p class="details">' + data[i].Type + '<span>: </span>' + data[i].Number + '</p>' +
          '</div>'



        div.appendChild(dir)

        linka = document.createElement('a')
        linka.className = "fas fa-phone-square"
        linka.innerHTML = "Call"
        linka.href = 'telprompt://' + data[i].Number
        linka.id = data[i].Number


        dir.lastChild.appendChild(linka);
      }

    }



    function search_dir() {

      let input = document.getElementById('searchbar').value
      input = input.toLowerCase();
      let x = document.getElementsByClassName('directory');

      for (i = 0; i < x.length; i++) {
        if (!x[i].innerHTML.toLowerCase().includes(input)) {
          x[i].style.display = "none";

        }
        else {
          console.log('else')
          x[i].style.display = "list-item";
        }
      }
    }
  </script>

</body>

</html>